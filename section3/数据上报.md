#西山居SDK数据统计服务端接入文档

****

<link rel="stylesheet" href="http://yandex.st/highlightjs/6.2/styles/googlecode.min.css">

<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script src="http://yandex.st/highlightjs/6.2/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
 $(document).ready(function(){
      $("h2,h3,h4,h5,h6").each(function(i,item){
        var tag = $(item).get(0).localName;
        $(item).attr("id","wow"+i);
        $("#category").append('<a class="new'+tag+'" href="#wow'+i+'">'+$(this).text()+'</a></br>');
        $(".newh2").css("margin-left",0);
        $(".newh3").css("margin-left",20);
        $(".newh4").css("margin-left",40);
        $(".newh5").css("margin-left",60);
        $(".newh6").css("margin-left",80);
      });
 });
</script>


<div id="category" style="display:none"></div>

****

###文档信息

	渠道SDK 数据统计服务端接入文档
	作者：
	SDK版本：2.0
	文档版本：1.0
	日期：2015.7.30

###文档版本说明
<table>
<tr>
<td>SDK版本</td><td>文档版本</td> <td>DK修改内容</td> <td>文档修改内容</td> <td>修改日期</td>  
</tr>
<tr>
<td>2.0 </td><td>1.0</td> <td>初版</td> <td>初版</td> <td>2015.7.30</td>
</tr>
</table>


##1. 数据统计服务器接入文档
```
	此文档为数据统计服务器接入文档
```
###1.1 接口描述
<table>

<tr>
<td><b><font face='微软雅黑'> 接口类型 </font></b></td>
<td> HTTP POST</td>
</tr>
<tr>
<tr>
<td><b><font face='微软雅黑'>接口URL</font></td></b>
<td><b><font face='微软雅黑' color='0000ff'>http://data.xgsdk.com/bisdk/batchpush/{version}/{appid}</font></b></td>
</tr>
<tr>
<td><b><font face='微软雅黑'>接口内容</font></td></b>
<td><font face='微软雅黑'>version为接口版本，目前版本为2.0；appid为xgsdk分配给各个游戏的唯一ID；具体值可以通过xgsdk的官网页面申请</font><b><font face='微软雅黑' color='0000ff'>http://dev.xgsdk.com</font></b><font face='微软雅黑'>；例如A游戏申请的appid是1234，则接口URL是</font><b><font face='微软雅黑' color='0000ff'>http://data.xgsdk.com/bisdk/batchpush/2.0/1234</font></b></td>
</tr>
<tr>
<td><b><font face='微软雅黑'>接口使用</font></td></b>
<td><font face='微软雅黑'>统计消息需要采取批量方式发送，可以采取每50条或每5分钟发送一次的策略</font></td>
</tr>
</table>

###1.2 消息说明与格式
<div>
<center><b><font face='微软雅黑' size='3'>-----简介-----</font></b></center></br>
<b><font face='微软雅黑'>修改日志：</font></b></br>
<font face='微软雅黑'>
<ol type='1' start='1'>
	<li>将message，device头合并成attribute头</li>
	<li>为自定义事件增加eventVal,eventDesc,并且修改了onEvent()接口</li>
	<li>为channel增加channelDesc字段</li>
	<li>为attribute增加sessionId字段</li>
</ol>
</font>
</div>

<div>
<b><font face='微软雅黑'>消息结构：</font></b></br>
<font face='微软雅黑'>post的消息采取JSON结，内容由包头和包体组成：&#123;&#123;head&#125;,&#123;content&#125;&#125;。包头包含整个消息包的一些基础信息，包体由多条消息组成，每条消息的结构如下：</font></br>
<font face='微软雅黑'><b><center>&#123;&#123;消息头&#125;&#123;游戏信息&#125;&#123;设备信息&#125;&#123;消息体&#125;&#125;</center></font></br><font face='微软雅黑'></b>除消息头和消息体是必选，其它结构为可选，具体参考具体接口的消息结构说明。</font>

</div>

<div>
<b><font face='微软雅黑'>消息样例：</font></b>
</div>

```
	{
  		"head": //包头
   		{
     		"timestamp":"2014-12-07 19:17:29.001",  //消息时间戳,消息发送的时间
     		"source":"client",
     		"gameVersion":"1.9.1"
     		"sign": 0ca175b9c0f726a831d895e269332461 //消息签名，具体见签名机制说明
   	 	},
  		"content":[ //包体,内部包含多条具体消息
     	{
       		...//单个消息具体参考下面各种消息的样例
      	},
      	{
       		...//单个消息具体参考下面各种消息的样例
      	}]
	}

```


<div>
<center><b><font face='微软雅黑' size='3'>-----消息格式-----</font></b></br></center>
<b><font face='微软雅黑'>包头：</font></b>
</div>

```
	"head":
  	{
    	"timestamp":string("yyyy-MM-dd HH:mm:ss.sss"),
    	"source"：string,
    	"gameVersion":string,
    	"sign":string
  	},

```
<div>
<style type="text/css">
	ky_font {font-family:"微软雅黑";}
</style>
<b><ky_font>参数说明：
<table class="wikitable">
<tr>
<th> <ky_font>参数</th>
<th> <ky_font>参数类型</th>
<th> <ky_font>最大长度 </th>
<th> <ky_font>说明</th>
<th> <ky_font>必需
</th></tr>
<tr>
<td> <ky_font>timestamp </td>
<td> <ky_font>String </td>
<td> <ky_font>23 </td>
<td><ky_font> 消息发送时的时间戳</td>
<td> <ky_font>Y
</td></tr>
<tr>
<td> <ky_font>source </td>
<td> <ky_font>string </td>
<td> <ky_font>10 </td>
<td> <ky_font>数据来源，client(客户端)或server(服务端) </td>
<td> <ky_font>Y
</td></tr>
<tr>
<td> <ky_font>gameVersion </td>
<td> <ky_font>string </td>
<td> <ky_font>10 </td>
<td> <ky_font>游戏的版本信息 </td>
<td> <ky_font>Y
</td></tr>
<tr>
<td> <ky_font>sign </td>
<td> <ky_font>string </td>
<td> <ky_font>40 </td>
<td> <ky_font>消息MD5签名,签名方式参考下面"签名机制" </td>
<td> <ky_font>Y
</td></tr></table>
</div>

<div>
<b><font face='微软雅黑'>包头：</font></b>
</div>

```
	"content":[
		{消息1},{消息2},...,{消息N}
	]

```

<div>
<b><font face='微软雅黑'>attribute头：</font></b>
</div>

```
	{{attribute}}:
    	"msgType":enum,
    	"msgSn":string,
    	"channel":string
    	"deviceId":string,
    	"os":string,
    	"network":string,
    	"clientIp":string,
    	"sessionId":string,
    	"appVersionId":string,
    	"sdkVersionId":string,
```

<div>
<b><font face='微软雅黑'>参数说明：</font></b>

<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> msgType </td>
<td> enum </td>
<td>  </td>
<td> ("device.connect", "account.signup", "account.login", "account.logout", "account.recharge", "account.consume", "role.signup", "role.login", "role.logout", "role.recharge", "role.gainGold", "role.consume", "server.online") </td>
<td> Y
</td></tr>
<tr>
<td> msgSn </td>
<td> string </td>
<td> 40 </td>
<td> 消息序列号，不需要全局唯一，但是需要保证相邻的几条消息不重复 </td>
<td> Y
</td></tr>
<tr>
<td> channel </td>
<td> string </td>
<td> 128 </td>
<td> 渠道ID，支持分层，以支持一级，二级，三级渠道等层次划分，示例值： xiaomi/home_page/banner1 </td>
<td> Y
</td></tr>
<tr>
<td> channelDesc </td>
<td> string </td>
<td> 128 </td>
<td> 渠道描述，支持分层，以支持一级，二级，三级渠道等层次划分，示例值： 小米/主页/广告条1 </td>
<td> N
</td></tr>
<tr>
<td> traceId </td>
<td> string </td>
<td> 40 </td>
<td> 跟踪ID，用于跟踪用户后续行为的ID </td>
<td> N
</td></tr>
<tr>
<td> ext </td>
<td> string </td>
<td> 40 </td>
<td> 扩展字段，采用key value的json map结构，用于在预定义中没有覆盖的自定义数据上报 </td>
<td> N
</td></tr>
<tr>
<td> deviceId </td>
<td> String </td>
<td> 100 </td>
<td> 设备id </td>
<td> Y
</td></tr>
<tr>
<td> os </td>
<td> string </td>
<td> 100 </td>
<td> 系统名：iOS、Android、WM等 </td>
<td> Y
</td></tr>
<tr>
<td> network </td>
<td> string </td>
<td> 20 </td>
<td> 网络类型wifi、gsm、3g等 </td>
<td> Y
</td></tr>
<tr>
<td> clientIp </td>
<td> String </td>
<td> 64 </td>
<td> 客户端IP，客户端接入统计时候可以不传，服务端接入统计时候需要传入 </td>
<td> N
</td></tr>
<tr>
<td> sessionId</td>
<td> String </td>
<td> 32</td>
<td> 会话ID，随机生成的32位字符串，用于标识一个登录，登出周期会话，用于统计在线时长使用 </td>
<td> N
</td></tr>
<tr>
<td> sdkVersionId</td>
<td> String </td>
<td> 32</td>
<td> xgsdk 版本号，如1.3.1 </td>
<td> N
</td></tr>
<tr>
<td> appVersionId</td>
<td> String </td>
<td> 32</td>
<td> 应用自身版本号，如1.3.1 </td>
<td> N
</td></tr></table>
</div>

<div>
<center><b><font face='微软雅黑' size='3'>-----消息枚举类型说明-----</font></b></br></center>
<ky_font>一、设备连接("device.connect")</br></br>
应用场景：
<ol type='1' start='1'>
	<li>如果游戏接入XGSDK客户端，不用单独发送该消息，游戏客户端在初始化XGSDK时候会自动发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，可以按下面格式发送消息</li>
</ol>
影响指标，参见xgsdk数据分析页面具体菜单和指标项：
<ol type='1' start='1'>
	<li>"实时概况"-"新增设备"</li>
	<li>"新增分析"-"新增设备"</li>
	<li>"留存分析"-"设备留存率"</li>
</ol>
格式：
</div>

```

	{
  		{{attribute}}
   			"osVersion":string,
   			"cpuFreq":string,
   			"memTotal":string,
   			"deviceBrand":string,
   			"deviceModel":string,
   			"isJailBroken":boolean,
   			"isPirated":boolean,
   			"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
<ky_font>参数说明：
<table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> osVersion </td>
<td> string </td>
<td> 100 </td>
<td> 系统版本号：ios 6.1.3、android 4.3等 </td>
<td> N
</td></tr>
<tr>
<td> cpuFreq </td>
<td> string </td>
<td> 100 </td>
<td> cpu频率，如：4 core 1.8 hz </td>
<td> N
</td></tr>
<tr>
<td> memTotal </td>
<td> string </td>
<td> 100 </td>
<td> RAM容量 </td>
<td> N
</td></tr>
<tr>
<td> deviceBrand </td>
<td> string </td>
<td> 100 </td>
<td> 设备提供商： 小米、华为、三星、苹果 </td>
<td> N
</td></tr>
<tr>
<td> deviceModel </td>
<td> string </td>
<td> 100 </td>
<td> 设备型号：小米note、华为meta7 iphone 6 plus等 </td>
<td> N
</td></tr>
<tr>
<td> isJailBroken </td>
<td> boolean </td>
<td>  </td>
<td> 是否越狱（针对苹果） </td>
<td> N
</td></tr>
<tr>
<td> isPirated </td>
<td> boolean </td>
<td>  </td>
<td> 是否破解（针对定制机） </td>
<td> N
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 设备连接发生时间 </td>
<td> Y
</td></tr></table>
消息样例：
</div>

```
	{
        //"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
         "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
         "os":"android",//安卓操作系统
         "network":"wifi", //设备网络类型


         "osVersion":"android-server-001",//游戏区服
         "cpuFreq":"MSM8974 2457600",//cpu信息
         "memTotal":"2931056"，//内存大小
         "deviceBrand":"Xiaomi", //设备品牌
         "deviceModel":"MI 4LTE", //设备型号
         "isJailBroken":"F", //是否越狱
         "isPirated":"F", //是否破解
         "timestamp":"2015-04-07 15:52:30.250"
 	}

```

<div>
二、账户登录("account.login")</br></br>
应用场景:
<ol type='1' start='1'>
	<li>如果游戏接入XGSDK客户端，不用单独发送该消息，XGSDK服务器完成登录鉴权后自动发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，可以按下面格式发送消息</li>
</ol>
影响指标:
<ol type='1' start='1'>
	<li>"实时概况"-"新增账户"</li>
	<li>"新增分析"-"新增账户"</li>
	<li>"留存分析"-"账号留存率"</li>
</ol>
格式:
</div>

```
	{
  		{{attribute}}
  		"accountId":string,
  		"accountName":string,
  		"loginFlag":enum,
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss"),
  		"sessionId":string
	}

```
<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 全游戏唯一,账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 全游戏唯一 </td>
<td> Y
</td></tr>
<tr>
<td> loginFlag </td>
<td> string </td>
<td>  </td>
<td> 登录标识["login"登入,"logout"登出] </td>
<td> Y
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 账户登录时间 </td>
<td> Y
</td></tr>
<tr>
<td> sessionId</td>
<td> string </td>
<td>  </td>
<td> 用户登录至登出的会话ID，用于关联login,heartbeat,logout数据 </td>
<td> Y
</td></tr></table>
消息样例:
</div>

```
	{
   		//"attribute":  
   		"msgType":"device.connect", //消息类型，具体见消息类型说明
   		"msgSn":"20141207191729001", //消息序号
   		"channel":"mi",//渠道ID
   		"deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
   		"os":"android",//安卓操作系统
   		"network":"wifi", //设备网络类型
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```

<div>
三、角色登录("role.login")</br></br>
应用场景:
<ol type='1' start='1'>
	<li>如果游戏接入XGSDK客户端，不用单独发送该消息，调用XGSDK的onEnterGame、OnExitGame、OnPause、OnResume方法后自动发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标: 参见xgsdk数据分析页面具体菜单和指标项
<ol type='1' start='1'>
	<li>"活跃分析"-所有指标</li>
	<li>"留存分析"-所有指标</li>
	<li>"时长分析"-所有指标</li>
	<li>"流失用户"-所有指标</li>
	<li>"回归用户"-所有指标</li>
	<li>"启动次数"-所有指标</li>
</ol>
格式:
</div>

```
	{
  		{{attribute}}
  		"zone":string,
  		"server":string,
 		"accountId":string,
  		"accountName":string,
  		"roleId":string,
  		"roleName":string,
  		"roleType":string,
  		"roleLevel":int,
  		"loginFlag":enum，
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> zone </td>
<td> string </td>
<td> 40</td>
<td> 游戏区 </td>
<td> N
</td></tr>
<tr>
<td> server </td>
<td> string </td>
<td> 40 </td>
<td> 游戏服 </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 账号名 </td>
<td> Y
</td></tr>
<tr>
<td> roleId </td>
<td> string </td>
<td> 40 </td>
<td> 角色ID </td>
<td> Y
</td></tr>
<tr>
<td> roleName </td>
<td> string </td>
<td> 60 </td>
<td> 角色名 </td>
<td> Y
</td></tr>
<tr>
<td> roleType </td>
<td> string </td>
<td> 20 </td>
<td>  角色类型 </td>
<td> N
</td></tr>
<tr>
<td> roleLevel </td>
<td> int </td>
<td>  </td>
<td> 角色等级 </td>
<td> Y
</td></tr>
<tr>
<td> loginFlag </td>
<td> string </td>
<td>  </td>
<td> 登录标识["login"登入,"logout"登出,"pause"暂停游戏,"resume"恢复游戏] </td>
<td> Y
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 角色登录时间 </td>
<td> N
</td></tr></table>
消息样例:
</div>

```
	{
		//"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
        "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
        "os":"android",//安卓操作系统
        "network":"wifi", //设备网络类型
  		"server":"风云争霸",
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"roleId":"role12345",
  		"roleName":"小清新",
  		"roleLevel":23,
  		"loginFlag":"login",
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```
<div>
四、角色充值("role.recharge")</br></br>
应用场景：
<ol>
	<li>如果游戏接入XGSDK客户端，不用单独发送该消息，XGSDK充值到账后自动发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标：参见xgsdk数据分析页面具体菜单和指标项
<ol type='1' start='1'>
	<li>"实时概况"-"充值金额"</li>
	<li>"付费分析"-所有指标</li>
	<li>"用户周期价值"-所有指标</li>
	<li>"收入统计"-所有指标</li>
	<li>"充值统计"-所有指标</li>
	<li>"付费率"-"付费率"</li>
</ol>
格式：
</div>

```
	{
  		{{attribute}}
  		"zone":string,
  		"server":string,
  		"accountId":string,
  		"accountName":string,
  		"roleId":string,
  		"roleName":string,
  		"roleType":string,
  		"roleLevel":int,
  		"rechargeChannel":string,
  		"currency":enum，
  		"money":number,
  		"gold":int,
  		"bindingGold":int,
  		"curGold":int,
  		"curBindingGold":int,
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> zone </td>
<td> string </td>
<td> 40</td>
<td> 游戏区 </td>
<td> N
</td></tr>
<tr>
<td> server </td>
<td> string </td>
<td> 40 </td>
<td> 游戏服 </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 账号名 </td>
<td> Y
</td></tr>
<tr>
<td> roleId </td>
<td> string </td>
<td> 40 </td>
<td> 角色ID </td>
<td> Y
</td></tr>
<tr>
<td> roleName </td>
<td> string </td>
<td> 60 </td>
<td> 角色名 </td>
<td> Y
</td></tr>
<tr>
<td> roleType </td>
<td> string </td>
<td> 20 </td>
<td>  角色类型 </td>
<td> N
</td></tr>
<tr>
<td> roleLevel </td>
<td> int </td>
<td>  </td>
<td> 角色等级 </td>
<td> Y
</td></tr>
<tr>
<td> rechargeChannel </td>
<td> string </td>
<td> 40 </td>
<td> 充值渠道,例如支付宝、财付通等 </td>
<td> N
</td></tr>
<tr>
<td> currency </td>
<td> enum </td>
<td>  </td>
<td> ("CNY", "KER", "HKD", "USD", "VND", "THB", "PHP", ...),确认多币种的处理方式 </td>
<td> Y
</td></tr>
<tr>
<td> money </td>
<td> number </td>
<td>  </td>
<td> 充值金额，浮点数，入库去尾法保留2位小数 </td>
<td> Y
</td></tr>
<tr>
<td> gold </td>
<td> int </td>
<td>  </td>
<td> 充值游戏代币数量 </td>
<td> Y
</td></tr>
<tr>
<td> bindingGold </td>
<td> int </td>
<td>  </td>
<td> 充值游戏赠送代币数量 </td>
<td> N
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 充值时间 </td>
<td> Y
</td></tr></table>
消息样例：
</div>

```

	{
        //"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
        "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
        "os":"android",//安卓操作系统
        "network":"wifi", //设备网络类型
  		"server":"风云争霸",
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"roleId":"role12345",
  		"roleName":"小清新",
  		"roleLevel":23,
  		"currency":"CNY",
  		"money": 6，
  		"gold": 100， //100代币
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```

<div>
五、角色消费("role.consume")</br></br>
应用场景:
<ol>
	<li>如果游戏接入XGSDK客户端，请使用OnEvent接口发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标: 参见xgsdk数据分析页面具体菜单和指标项
<ol>
	<li>"消费统计"-所有指标</li>
</ol>
格式:
</div>

```
	调用客户端OnEvent(string eventId,string content)接口发送消息：
	eventId=role.consume
	content={
		"accountId":string,
		"accountName":string,
		"roleId":string,
		"roleName":string,
		"roleType":string,
		"roleLevel":string,
		"activity":string,
		"itemCatalog":string,
		"itemId":string,
		"itemName":string,
		"consumeGold":int,
		"consumeBindingGold":int
	}

```

```

	直接Http方式发送消息：
	{
  		{{attribute}}
  		"zone":string,
  		"server":string,
  		"accountId":string,
  		"accountName":string,
  		"roleId":string,
  		"roleName":string,
  		"roleType":string,
  		"roleLevel":int,
  		"activity":string,
  		"itemCatalog":string,
  		"itemId":string,
  		"itemName":string,
  		"itemCount":int,
  		"listPrice":int,
  		"transPrice":int,
  		"payGold":int,
  		"payBindingGold":int
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> zone </td>
<td> string </td>
<td> 40</td>
<td> 游戏区 </td>
<td> N
</td></tr>
<tr>
<td> server </td>
<td> string </td>
<td> 40 </td>
<td> 游戏服 </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 账号名 </td>
<td> Y
</td></tr>
<tr>
<td> roleId </td>
<td> string </td>
<td> 40 </td>
<td> 角色ID </td>
<td> Y
</td></tr>
<tr>
<td> roleName </td>
<td> string </td>
<td> 60 </td>
<td> 角色名 </td>
<td> Y
</td></tr>
<tr>
<td> roleType </td>
<td> string </td>
<td> 20 </td>
<td>  角色类型 </td>
<td> N
</td></tr>
<tr>
<td> roleLevel </td>
<td> int </td>
<td>  </td>
<td> 角色等级 </td>
<td> Y
</td></tr>
<tr>
<td> activity </td>
<td> string </td>
<td> 100 </td>
<td> 消费活动 </td>
<td> N
</td></tr>
<tr>
<td> itemCatalog </td>
<td> string </td>
<td> 40 </td>
<td> 消费类别 </td>
<td> Y
</td></tr>
<tr>
<td> itemId </td>
<td> string </td>
<td> 40 </td>
<td> 消费项ID </td>
<td> Y
</td></tr>
<tr>
<td> itemName </td>
<td> string </td>
<td> 60 </td>
<td> 消费项名 </td>
<td> Y
</td></tr>
<tr>
<td> consumeGold </td>
<td> int </td>
<td>  </td>
<td> 消费代币数 </td>
<td> Y
</td></tr>
<tr>
<td> consumeBindingGold </td>
<td> int </td>
<td>  </td>
<td> 消费赠送代币数量 </td>
<td> N
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 消费时间 </td>
<td> Y
</td></tr></table>
消息样例:
</div>

```

	{
        //"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
        "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
        "os":"android",//安卓操作系统
        "network":"wifi", //设备网络类型
  		"server":"风云争霸",
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"roleId":"role12345",
  		"roleName":"小清新",
  		"roleLevel":23,
  		"itemCatalog":"一次性道具",
  		"itemId": "2254123"，
  		"itemName": "生命药水"
  		"consumeGold": 60，
  		"curGold": 450,
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```

<div>
六、等级变更("role.level")</br></br>
应用场景:
<ol>
	<li>如果游戏接入XGSDK客户端，请通过onEvent接口发送</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标:
<ol>
	<li>1."用户等级分布"</li>
</ol>
格式:
</div>

```

	调用客户端OnEvent(string eventId,string content)接口发送消息：
	eventId=role.level
	content="{
		"accountId":string,
		"accountName":string,
		"roleId":string,
		"roleName":string,
		"roleType":string,
		"roleLevel":int
	}"

```

```

	使用HTTP直接发送：
	{
  		{{attribute}}
  		"zone":string,
  		"server":string,
  		"accountId":string,
  		"accountName":string,
  		"roleId":string,
 		"roleName":string,
  		"roleType":string,
  		"roleLevel":int,
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 可空
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> N
</td></tr>
<tr>
<td> zone </td>
<td> string </td>
<td> 40</td>
<td> 游戏区 </td>
<td> N
</td></tr>
<tr>
<td> server </td>
<td> string </td>
<td> 40 </td>
<td> 游戏服 </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 账号名 </td>
<td> Y
</td></tr>
<tr>
<td> roleId </td>
<td> string </td>
<td> 40 </td>
<td> 角色ID </td>
<td> Y
</td></tr>
<tr>
<td> roleName </td>
<td> string </td>
<td> 60 </td>
<td> 角色名 </td>
<td> Y
</td></tr>
<tr>
<td> roleType </td>
<td> string </td>
<td> 20 </td>
<td>  角色类型 </td>
<td> N
</td></tr>
<tr>
<td> roleLevel </td>
<td> int </td>
<td>  </td>
<td> 角色变更后的等级 </td>
<td> N
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 角色等级变更时间 </td>
<td> N
</td></tr></table>
消息样例:
</div>

```

	{
        //"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
        "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
        "os":"android",//安卓操作系统
        "network":"wifi", //设备网络类型
  		"server":"风云争霸",
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"roleId":"role12345",
  		"roleName":"小清新",
  		"roleLevel":23,
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```

<div>
七、角色关卡("role.mission")</br></br>
应用场景:
<ol>
	<li>如果游戏接入XGSDK客户端，请通过onEvent接口发送</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标: 参见xgsdk数据分析页面具体菜单和指标项
<ol>
	<li>"游戏关卡统计"</li>
</ol>
格式:
</div>

```

	调用客户端OnEvent(string eventId,string content)接口发送消息：
	eventId=role.mission
	content="{
		"accountId":string,
		"accountName":string,
		"roleId":string,
		"roleName":string,
		"roleType":string,
		"roleLevel":int,
		"missionName":string,
		"missionFlag":enum
	}"

```

```

	使用HTTP发送
	{
  		{{attribute}}
  		"zone":string,
  		"server":string,
  		"accountId":string,
  		"accountName":string,
  		"roleId":string,
  		"roleName":string,
  		"roleType":string,
  		"roleLevel":int,
  		"missionName":string,
  		"missionFlag":enum,
  		"timestamp":string("yyyy-MM-dd HH:mm:ss.sss")
	}

```

<div>
参数说明：
<ky_font><table class="wikitable">

<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> N
</td></tr>
<tr>
<td> zone </td>
<td> string </td>
<td> 40</td>
<td> 游戏区 </td>
<td> N
</td></tr>
<tr>
<td> server </td>
<td> string </td>
<td> 40 </td>
<td> 游戏服 </td>
<td> Y
</td></tr>
<tr>
<td> accountId </td>
<td> string </td>
<td> 40 </td>
<td> 账号ID </td>
<td> Y
</td></tr>
<tr>
<td> accountName </td>
<td> string </td>
<td> 60 </td>
<td> 账号名 </td>
<td> Y
</td></tr>
<tr>
<td> roleId </td>
<td> string </td>
<td> 40 </td>
<td> 角色ID </td>
<td> Y
</td></tr>
<tr>
<td> roleName </td>
<td> string </td>
<td> 60 </td>
<td> 角色名 </td>
<td> Y
</td></tr>
<tr>
<td> roleType </td>
<td> string </td>
<td> 20 </td>
<td>  角色类型 </td>
<td> N
</td></tr>
<tr>
<td> roleLevel </td>
<td> int </td>
<td>  </td>
<td> 角色等级 </td>
<td> Y
</td></tr>
<tr>
<td> missionName </td>
<td> string </td>
<td> 128 </td>
<td>  关卡名 </td>
<td> Y
</td></tr>
<tr>
<td> missionFlag </td>
<td> string </td>
<td> 40 </td>
<td>  关卡标识["enter"进入关卡,"success"成功退出关卡,"failed"失败退出关卡] </td>
<td> Y
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 关卡时间 </td>
<td> N
</td></tr></table>
消息样例:  
</div>

```

	{
        //"attribute"
        "msgType":"device.connect", //消息类型，具体见消息类型说明
        "msgSn":"20141207191729001", //消息序号
        "channel":"mi",//渠道ID
        "deviceId":"599a830eb0019b421ce35ec4a80e0e71",//设备ID
        "os":"android",//安卓操作系统
        "network":"wifi", //设备网络类型
  		"server":"风云争霸",
  		"accountId":"acc12345",
  		"accountName":"13422371324",
  		"roleId":"role12345",
  		"roleName":"小清新",
  		"roleLevel":24,
  		"missionName":"南天门试炼",
  		"missionFlag":"enter",
  		"timestamp":"2015-04-07 15:52:30.250"
	}

```

<div>
八、自定义事件("custom.event")</br></br>
应用场景:
<ol>
	<li>如果游戏接入XGSDK客户端，可以通过OnEvent接口发送该消息</li>
	<li>如果游戏没有接入XGSDK客户端，或服务端发送该消息，可以按下面格式发送消息</li>
</ol>
影响指标: 参见xgsdk数据分析页面具体菜单和指标项
<ol>
	<li>"漏斗分析"</li>
	<li>"事件列表"</li>
</ol>
格式:
</div>

```

	调用客户端OnEvent(string eventId,String eventDesc,int eventVal,string ext)接口发送消息：
	调用客户端OnEvent(string eventId,String eventDesc,int eventVal,Map ext)接口发送消息：
	eventId=自定义事件ID
	eventDesc=自定义事件描述
	ext=JSON结构的事件内容字符串,扩展字段

```

```

	通过HTTP接口接入:
	{
  		{{attribute}}
  		"eventId":string,
  		"eventDesc": string,
  		"eventBody":string,
  		"timestamp":"string"
  		"eventVal" : int
	}

```

<div>

参数说明：
<ky_font>
<table class="wikitable">
<tr>
<th> 参数 </th>
<th> 参数类型 </th>
<th> 最大长度 </th>
<th> 说明 </th>
<th> 必需
</th></tr>
<tr>
<td> {attribute} </td>
<td>  </td>
<td>  </td>
<td>  </td>
<td> Y
</td></tr>
<tr>
<td> eventId </td>
<td> string </td>
<td> 128 </td>
<td> 支持事件分层，如 click/click_game </td>
<td> Y
</td></tr>
<tr>
<td> eventDesc </td>
<td> string </td>
<td> 128 </td>
<td> 支持事件分层，如 点击/游戏点击  </td>
<td> Y
</td></tr>
<tr>
<td> eventBody </td>
<td> string </td>
<td> 2048 </td>
<td>  </td>
<td> N
</td></tr>
<tr>
<td> timestamp </td>
<td> string </td>
<td>  </td>
<td> 事件发生时间 </td>
<td> Y
</td></tr>
<tr>
<td> eventVal</td>
<td> int </td>
<td>  </td>
<td> 事件发生的值，可以生成区间统计数据，如1-10,10-20的统计数据 </td>
<td> Y
</td></tr>
</table>
</div>

<div>
<center><b><font face='微软雅黑' size='3'>-----签名机制-----</font></b></br></center>
<ky_font>签名机制采取MD5签名，使用包体的内容(content里面的内容)加上appKey拼接后签名，其中appKey为xgsdk唯一分配给一个游戏的密钥值。
