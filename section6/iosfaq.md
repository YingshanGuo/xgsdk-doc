## ios 接入常见问题
<a id="category0" s></a>
### 1. 正版支付必读




根据以往游戏接入的经验和教训，汇总了部分问题，以下内容请务必认真阅读.

#### 1.1 什么是包名和产品ID？
包名和产品ID必须正确提供给西瓜，否则会导致无法测试支付功能。  
**  特别提醒：包名中不能含有下划线"_" 。**  

打开itunes,登陆开发者账号查看如下：

<img src="../section2/img/iap1.jpg"/>

#### 1.2 什么是沙箱账号？

沙箱账号用于游戏测试支付，只要是xcode生成的包，均可使用沙箱账号测试（即使游戏已经在AppStore上架）。
但是从AppStore上下载的包，无法使用沙箱账号支付。  
打开itunes,登陆开发者账号查看如下：

<img src="../section2/img/iap2.jpg"/>

#### 1.3 是否屏蔽了玩家连续点击支付按钮的行为？
玩家点击支付时，因网络缘故，访问AppStore的时间较长，导致界面响应较慢。玩家有可能在此期间连续下单，影响支付结果。游戏请务必做好屏蔽连续支付，以防玩家重复点击。处理方法：
游戏在调用xgsdk支付接口前，拉起一个模态窗口，**待xgsdk返回支付结果后**，关闭该模态窗口。

#### 1.4 需要提供哪些注册信息？
- 在iTunes上注册的产品bundleId。
- itunes注册的产品ID列表。
- apple沙箱充值的测试账号。

#### 1.5 弹不出apple的支付对话框？
- 请确认xcode中配置的bundleid正确
- 请确认支付时传入的productId正确
- 请确认“设置-iTunes账户” 正确（沙箱测试时，填写沙箱测试账号）。
- 请确认“设置-iTunes账户” 正确。（若账号处于灰色状态，即不可编辑，也不可注销。说明本地网络有误，需重启设备）。
- 设备是越狱机器。请用非越狱机测试正版支付。


#### 1.6 产生了订单，但支付信息不全？
- 请确认支付接口中，buyInfo.customInfo字段，buyInfo.uid字段,不为空。

---

### 2. iOS正版支付接入步骤


<div id="category" style="display:none"></div>


#### 2.1 阅读接入必读  

正版支付的接入前必读，即<a href="#category0">正版支付必读</a>


#### 2.2 游戏提供必要参数

<p>主要包括：</p>
- 应用在iTunes上的注册信息：bundleId ， productId。
- 是否接入登陆功能。
- 登陆渠道的注册信息（目前支持小米和金山的sdk登陆）。
- 沙箱账号密码和开发者证书（便于xgsdk为游戏测试支付功能）。


#### 2.3 西瓜运营为游戏注册，并配置参数
xgsdk的运营将游戏提供的参数，录入到系统。并通知xgsdk的开发进行接入准备工作（即为游戏提供测试demo）。

#### 2.4 开发提供测试demo,打包工具
demo应用使用了游戏提供的参数，通过简单的按钮，模拟玩家的登陆和支付动作。游戏开发参考该demo进行接入。<br>
打包工具目前支持命令行模式。使用方法参考 <a href="../section1/sepcification.html#packageios" target="_blank">ios打包工具使用指南</a> ，建议花几分钟进行阅读，以了解xgsdk的iOS打包原理。

#### 2.5 游戏开始接入
参考demo，完成接入和测试。  
注：请游戏务必按照以上步骤进行接入。在保证前3步准备就绪的情况下，再进行接入和调试。
